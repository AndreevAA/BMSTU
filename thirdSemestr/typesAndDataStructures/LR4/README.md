<table>
<tbody>
<tr class="odd">
<td><img src="media/image1.jpg" style="width:0.80208in;height:0.90625in" /></td>
<td><p><strong>Министерство образования и науки Российской Федерации</strong></p>
<p><strong>Федеральное государственное бюджетное образовательное учреждение</strong></p>
<p><strong>высшего образования</strong></p>
<p><strong>«Московский государственный технический университет</strong></p>
<p><strong>имени Н.Э. Баумана</strong></p>
<p><strong>(национальный исследовательский университет)»</strong></p>
<p><strong>(МГТУ им. Н.Э. Баумана)</strong></p></td>
</tr>
</tbody>
</table>

ФАКУЛЬТЕТ ИУ

КАФЕДРА ИУ7

**<u>ОТЧЕТ ПО ЛР2 ТИПОВ И СТРУКТУР ДАННЫХ, Вариант 3</u>**

Студент Андреев Александр Алексеевич

фамилия, имя, отчество

Группа ИУ7-34Б

Тип практики учебная

Студент **\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_**

подпись, дата фамилия, и.о.

Преподаватель **\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_**

> подпись, дата фамилия, и.о.

Оценка
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

9 октября 2020

**Оглавление**
==============

**[Оглавление](#оглавление) 2**

**[1. Цель работы](#цель-работы) 2**

**[2. Описание условия задачи](#описание-условия-задачи) 2**

**[3. Описание ТЗ, включающее внешнюю
спецификацию](#описание-тз-включающее-внешнюю-спецификацию) 3**

> [a. Описание исходных данных](#a.-описание-исходных-данных) 3
>
> [b. Описание задачи, реализуемой
> программой](#b.-описание-задачи-реализуемой-программой) 3
>
> [c. Способ обращения программы](#c.-способ-обращения-программы) 4
>
> [d. Описание возможных аварийных ситуаций и ошибок
> пользователя](#d.-описание-возможных-аварийных-ситуаций-и-ошибок-пользователя)
> 5

**[4. Описание внутренних СД](#описание-внутренних-сд) 5**

**[5. Алгоритм](#алгоритм) 7**

**[6. Набор тестов с указанием, что
проверяется](#набор-тестов-с-указанием-что-проверяется) 9**

**[7. Выводы по проделанной работе](#выводы-по-проделанной-работе) 10**

**[8. Контрольные вопросы](#контрольные-вопросы) 10**

**1. Цель работы**
==================

В качестве цели работы ставится приобретение навыков работы с типом
данных “запись” (“структура”), содержащим вариантную часть, и с данными,
хранящимися в таблицах. оценить относительную эффективность программы (в
процентах) по времени и по используемому объему памяти в зависимости от
используемого алгоритма и объема сортируемой информации.

**2. Описание условия задачи**
==============================

Создать таблицу, содержащую не менее 40-ка записей (тип – запись с
вариантами (объединениями)). Упорядочить данные в ней по возрастанию
ключей, двумя алгоритмами сортировки, где ключ – любое невариантное поле
(по выбору программиста это Возраст студента / Средний балл студента /
Номер дома или общежития / Номер комнаты или квартиры), используя: а)
саму таблицу, б) массив ключей. (Возможность добавления и удаления
записей в ручном режиме обязательна). Осуществить поиск информации по
варианту.

Имеются описания:

Type жилье = (дом, общежитие);

Данные : Фамилия, имя, группа, пол (м, ж), возраст, средний балл за
сессию, дата поступления

адрес :

> дом : (улица, №дома, №кв );
>
> общежитие : (№общ., №комн.);

Ввести общий список студентов.

Вывести список студентов, живущих в общежитии указанного года
поступления

**3. Описание ТЗ, включающее внешнюю спецификацию**
===================================================

a. Описание исходных данных
---------------------------

Исходные данные программа получает из считанного текстового файла, где

-   каждая запись должна находиться в отдельной строке

-   в первой строчке файла находится целое число, равное количеству
    > студентов в файле

-   каждая запись имеет собственные ограничения по размеру и
    > спецификацию

-   каждая запись находится в отдельной строчке

-   после последней записи находится пустая строка

Ограничения на записи во входном файле:

1.  Длина фамилии не более 256 символов

2.  Длина имени не более 256 символов

3.  Длина названия улицы адреса дома не более 256 символов

4.  Пол студента описывается, как 0/1 (Ж/М)

5.  Возраст студента число натуральное не более 100 лет

6.  Средний балл студента число вещественное положительное не более 100

7.  Номер дома или общежития число натуральное не более 1000

8.  Номер комнаты или квартиры число натуральное не более 9999

9.  День - число натуральное не более 31

10. Месяц - число натуральное не более 12

11. Год - число натуральное не более 9999

b. Описание задачи, реализуемой программой
------------------------------------------

Программа должна уметь совершать следующие действия с входящим файлом:

-   Закрывать программу по команде **EXIT**

-   Выводить список всех студентов по команде - **PRINT\_ALL**

-   Выводить отфильтрованных студентов по дате зачисления в
    > университет - **PRINT\_FILTERED\_STUDENTS**

-   Сортировать студентов таблицы по ключам (accommodation, surname,
    > name, gender, age, average\_score\_per\_session, street,
    > house\_or\_campus\_number, flat\_or\_room\_number, date\_in) и
    > вывести сравнительную информацию по сортировкам по ключам и общей
    > по команде, вывод таблицы ключей - **SORT\_TABLE\_BY\_KEY**

-   Добавлять запись в таблицу по команде - **ADD\_NOTE**

-   Удалять запись из таблица по команде - **DELETE\_NOTE**

-   Сохранять примененные изменения обратно в файл - **SAVE\_TABLE**

c. Способ обращения программы
-----------------------------

Скомпилированная программа запускается командой **“./a.out X”** на Unix
и **“./a.exe X”** на Windows, где X - это названия входного текстового
файла, например **“test\_1.txt”**

При запуске программа должна вывести инструкцию по своему применению:

**“Программа обработки текстовых данных запущена.**

**Программа умеет выполнять команды:**

**EXIT - Закрытие программы**

**PRINT\_ALL - Печать всех студентов**

**PRINT\_FILTERED\_STUDENTS - Печать только студентов по ключам**

**SORT\_TABLE\_BY\_KEY - Сортировка таблицы по ключу, вывод таблицы
ключей и сравнение работы алгоритмов**

**ADD\_NOTE - Добавление записи в таблицу**

**DELETE\_NOTE - Удаление записи из таблицы**

**SAVE\_TABLE - Сохранение изменений**

**”**

Далее после ввода соответствующей команды программа должна выполнять
команды пользователя.

-   **Команда EXIT  
    > **При вводе команды **EXIT** программа завершает работу без
    > каких-либо предупреждений.

-   **Команда PRINT\_ALL**  
    > Программа выводит данные входного файла в виде таблицы в консоль,
    > где в обязательном порядке должны быть отображены все поля
    > стратруктруы и подписаны столбцы.

-   **Команда** **PRINT\_FILTERED\_STUDENTS  
    > **Программа должна запросить у пользователя ключ фильтрации
    > “Укажите дату поступления через пробел (ДД ММ ГГ): “, после ввода
    > которых пользователю выводится на экран отфильтрованная таблица
    > либо сообщается о том, что ничего не найдено.

-   **Команда SORT\_TABLE\_BY\_KEY  
    > **Программа должна вывести список возможных для фильтрации ключей
    > (accommodation, surname, name, gender, age,
    > average\_score\_per\_session, street, house\_or\_campus\_number,
    > flat\_or\_room\_number, date\_in), после чего запросить ключ для
    > сортировки, далее программа сортирует таблицу и выведет
    > сравнительную информацию по двум примененным к исходному массиву
    > структур сортировкам. Команда выведет таблицу ключей по
    > отсортированному полю, где в первом столбце номер в исходном и во
    > втором значение.

-   **Команда ADD\_NOTE  
    > **Программа должна запросить данные всех полей необходимой для
    > добавления записи в таблицы, после чего должна добавить. Причем
    > запросы по заполнению данных общежития и дома должны отличатся по
    > приглашению ввода.

-   **Команда DELETE\_NOTE  
    > **Программа должна запросить данные всех полей необходимой для
    > удаления записи в таблицы, после чего должна сообщить о том, что
    > их не существует. либо удалить их. Причем запросы по удалению
    > данных общежития и дома должны отличатся по приглашению ввода.

-   **Команда SAVE\_TABLE  
    > **Программа должна сохранить таблицу в тот файл, из которого ее
    > считала при запуске.

При наличии аварийных ситуаций и ошибок пользователя программа должна
вывести соответствующее сообщение и не должна завершить свою работу
абортно.

d. Описание возможных аварийных ситуаций и ошибок пользователя
--------------------------------------------------------------

В представленной ниже **Таблице 1** отражены действия программы при
различных возможных, допущенных пользователем, при ее использовании
ошибках.

Табл.1

| Действие программы при различных ошибках |                                                                                              |                                                                                          |
|------------------------------------------|----------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|
| №                                        | Действие пользователя                                                                        | Реакция программы                                                                        |
| 1                                        | Указанного файла пользователем для чтения не существует.                                     | Программа выведет сообщение об ошибке “Указанного файла для чтения не существует.”       |
| 2                                        | Указанный файл пользователем оказывается пустым                                              | Программа выведет сообщение об ошибке “Указанный файл пустой.”                           |
| 3                                        | При чтение данных из файла возникнут ошибки                                                  | Программа выведет сообщение об ошибке “При чтение данных из файла возникли ошибки”       |
| 4                                        | Пользователь вводит некорректные команды (те команды, которые не представлены в списке меню) | Программа выведет сообщение об ошибке “Вы ввели некорректный ключ. Попробуйте заново...” |
| 5                                        | В случае, если программа не нашла записей при фильтрации                                     | Программа выведет сообщение об ошибке “Ничего не найдено….”                              |

**4. Описание внутренних СД**
=============================

Считанные из консоли числа внутри программы хранятся в виде структуры
**number,** которая представляет из себя (Рис. 1)

INPUT\_STRING\_MAX\_SIZE =  256;

INPUT\_TABLE\_INFORMATION\_MAX\_SIZE = 256;

Рис. 1

<table>
<tbody>
<tr class="odd">
<td><p>typedef struct date</p>
<p>{</p>
<p>int day;</p>
<p>int month;</p>
<p>int year;</p>
<p>} date;</p>
<p>typedef struct student_personal_information</p>
<p>{</p>
<p>char surname[INPUT_STRING_MAX_SIZE];</p>
<p>char name[INPUT_STRING_MAX_SIZE];</p>
<p>int gender;</p>
<p>int age;</p>
<p>double average_score_per_session;</p>
<p>struct date receipt_date;</p>
<p>} student_personal_information;</p>
<p>typedef struct social_home_address</p>
<p>{</p>
<p>int house_number;</p>
<p>int room_number;</p>
<p>} social_home_address;</p>
<p>typedef struct social_home</p>
<p>{</p>
<p>int is_social_home;</p>
<p>struct student_personal_information student;</p>
<p>struct social_home_address address;</p>
<p>} social_home;</p>
<p>typedef struct private_home_address</p>
<p>{</p>
<p>char street[INPUT_TABLE_INFORMATION_MAX_SIZE];</p>
<p>int house_number;</p>
<p>int flat_number;</p>
<p>} private_home_address;</p>
<p>typedef struct private_home</p>
<p>{</p>
<p>struct student_personal_information student;</p>
<p>struct private_home_address address;</p>
<p>} private_home;</p>
<p>typedef union students_accommodation_information</p>
<p>{</p>
<p>int is_social_home;</p>
<p>struct social_home social_home;</p>
<p>struct private_home private_home;</p>
<p>} students_accommodation_information;</p>
<p>typedef struct sort_key</p>
<p>{</p>
<p>int position;</p>
<p>double double_value;</p>
<p>} sort_key;</p></td>
</tr>
</tbody>
</table>

**5. Алгоритм**
===============

Основная программа  
Вывод меню на экран. В случае, если Пользователь выбирает пункт:

EXIT:  
программа завершает работу

PRINT\_ALL:

функция output\_all\_students (см. функции)

PRINT\_FILTERED\_STUDENTS:

функция output\_filtered\_students (см. функции)

SORT\_TABLE\_BY\_KEY:

функция sort\_students\_by\_key (см. функции)

ADD\_NOTE:

функция add\_note (см. функции)

DELETE\_NOTE:  
функция delete\_note (см. функции)

SAVE\_TABLE:

функция save\_information\_into\_file (см. функции)  
Функции

**void output\_all\_students(union students\_accommodation\_information
\*input\_table\_information, int \*input\_table\_information\_size);  
**Функция вывода всех студентов на экран получает на вход массив
**union** **students\_accommodation\_information
\*input\_table\_information** и его размер **int
\*input\_table\_information\_size**. При положительном размере выводит
на экран сначала шапку таблицы, далее в цикле вызывает вывод каждой
записи в консоль.

**void output\_filtered\_students(union
students\_accommodation\_information \*input\_table\_information, int
input\_table\_information\_size);**

Функция вывода всех студентов на экран получает на вход массив **union**
**students\_accommodation\_information \*input\_table\_information** и
его размер **int \*input\_table\_information\_size**. При положительном
размере функция запрашивает у пользователя дату поступления в
университете в указанном выше формате, после чего циклически проходит
массив и при совпадении даты выводит информацию на экран.

**void sort\_students\_by\_key(union
students\_accommodation\_information \*input\_table\_information, int
input\_table\_information\_size);  
**Функция вывода всех студентов на экран получает на вход массив
**union** **students\_accommodation\_information
\*input\_table\_information** и его размер **int
\*input\_table\_information\_size**. При положительном размере функция
запрашивает у пользователя ключ для сортировка таблицы, после чего
создается сортирует массив sort\_key
key\_sort\_table\[INPUT\_TABLE\_INFORMATION\_MAX\_SIZE\], в который
записываются положение в исходном массиве и его значение, далее
происходит сортировка по ключам с засеканием времени и аналогично, но
уже с исходным массивом структуры **union**
**students\_accommodation\_information \*input\_table\_information** по
введенному ключу также производится сортировка и засекает время работы.
В результате выводится сравнительная информацию по обеим сортировкам.
Выводится таблица ключей.

**int add\_note(union students\_accommodation\_information
\*input\_table\_information, int \*input\_table\_information\_size);**

Функция вывода всех студентов на экран получает на вход массив **union**
**students\_accommodation\_information \*input\_table\_information** и
его размер **int \*input\_table\_information\_size**. При положительном
размере функция запрашивает у пользователя данные всех полей:

если Общежитие

Запрашивает Фамилию, Имя, Пол, Возраст, Средний балл за семестр, Номер
общежития, Номер комнаты, Даты зачисления.

если Дом  
Запрашивает Фамилию, Имя, Пол, Возраст, Средний балл за семестр, Улицу
дома, Номер дома, Номер квартиры, Даты зачисления.  
После успешного получения данных программа расширяет массив **union**
**students\_accommodation\_information \*input\_table\_information** и
добавляет в него запись.

**int delete\_note(union students\_accommodation\_information
\*input\_table\_information, int \*input\_table\_information\_size);**

Функция вывода всех студентов на экран получает на вход массив **union**
**students\_accommodation\_information \*input\_table\_information** и
его размер **int \*input\_table\_information\_size**. При положительном
размере функция запрашивает у пользователя данные всех полей:

если Общежитие

Запрашивает Фамилию, Имя, Пол, Возраст, Средний балл за семестр, Номер
общежития, Номер комнаты, Даты зачисления.

если Дом  
Запрашивает Фамилию, Имя, Пол, Возраст, Средний балл за семестр, Улицу
дома, Номер дома, Номер квартиры, Даты зачисления.  
После успешного получения данных программа при наличии текущего элемента
в массиве **union** **students\_accommodation\_information
\*input\_table\_information** и добавляет его.

**void save\_information\_into\_file(char const \*argv\[\], union
students\_accommodation\_information \*input\_table\_information, int
\*input\_table\_information\_size);**

Функция вывода всех студентов на экран получает на вход аргументы с
данными для записи в файл, массив **union**
**students\_accommodation\_information \*input\_table\_information** и
его размер **int \*input\_table\_information\_size**. После чего
записывает в первую строчку размер массива, далее циклически проходит по
массиву и записывает каждую запись в файл с окончание “\\n”.

**6. Набор тестов с указанием, что проверяется**
================================================

В представленных ниже **Таблица 2** отражены тестирование устойчивости
работы консольного меню программы и демонстрация устойчивости работы
программы к различному типу выполняемых с ней операций пользователем
соответственно.

Табл. 2

| Тестирование устойчивости работы программы |                                                                                                                                                                    |                                                                                                               |                                                                                                      |
|--------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| №                                          | Ввод пользователя                                                                                                                                                  | Реакция программы                                                                                             | Что проверяется данной операцией?                                                                    |
| 1                                          | TEST\_MENU                                                                                                                                                         | Программа выводит “Вы указали неверную команду. Попробуйте еще раз...”                                        | Устойчивость программы к вводу неверной команды меню                                                 |
| 2                                          | При вводе некорректного значения в любом пункте меню, где требуется дополнительный ввод (DELETE\_NOTE, ADD\_NOTE, SORT\_TABLE\_BY\_KEY, PRINT\_FILTERED\_STUDENTS) | Программа выводит “Вы указали неверную команду. Попробуйте еще раз...”                                        | Устойчивость программы к вводу неверной команды внутри пунктов меню                                  |
| 3                                          | Пользователем введен несуществующий файл                                                                                                                           | Программа выводит “Введенный файл оказался пустым или не может быть прочитан. Исправьте и повторите попытку.” | Устойчивость к открытию несуществующего файла                                                        |
| 4                                          | Введенный пользователем файл оказался пустым                                                                                                                       | Программа выводит “Введенный файл оказался пустым или не может быть прочитан. Исправьте и повторите попытку.” | Устойчивость к чтению пустого файла                                                                  |
| 5                                          | Количество аргументов при запуске программы оказалось меньше или больше допустимого                                                                                | Программа выводит “Допущена ошибка в аргументах при запуске. Исправьте и повторите попытку.”                  | Устойчивость к запуску программы с неверными аргументами запуска                                     |
| 6                                          | Данные в открытом пользователем файле введены некорректно                                                                                                          | Программа выводит “При чтение данных из файла возникли проблемы. Исправьте файл и повторите попытку.”         | Корректная работа программы с выводом сообщения об ошибке при неверном содержании открываемого файла |
| 7                                          | Фильтрация студентов дала нулевой результат                                                                                                                        | Программа выводит “Ничего не найдено...”                                                                      | Корректная работа при отсутствии найденных студентов во время фильтрации                             |

**7. Выводы по проделанной работе**
===================================

Рис. 2

<table>
<tbody>
<tr class="odd">
<td><p>Информация по сортировкам:</p>
<p>1. Сортировка пузырьком</p>
<p>Сортировка не по ключам: 0.000319(сек)</p>
<p>Сортировка по ключам: 0.000018(сек)</p>
<p>Сортировка по ключам быстрее на: 94.357367%</p>
<p>2. Сортировка qsort</p>
<p>Сортировка не по ключам: 0.000042(сек)</p>
<p>Сортировка по ключам: 0.000003(сек)</p>
<p>Сортировка по ключам быстрее на: 92.857143%</p></td>
</tr>
</tbody>
</table>

Подобное решение с использование Union в программе позволяет более
структурно подходить к решению задачи. После использование чего я понял,
что Union позволит делегировать написание отдельных модулей обращения со
структурой разным программистам, таким образом сократив временные
издержки.

На основе Рис. 2, где указан анализ по сравнению сортировок можно
сказать, что когда сортируется таблица ключей, то экономится время, так
как перестановка записей в исходной таблице отсутствует. Он заметен при
большмй размере таблиц. Выбор данных из основной таблицы в порядке,
определенном таблицей ключей,также замедляет вывод данных.

На ключи потребовалось 784 Байта (3 х 256 x char + 6 x int + 1 x double
= 768 x 1 Байт + 6 x 2 Байт + 1 x 4 Байта = 784 Байт)

**8. Контрольные вопросы**
==========================

**1.Как выделяется память под вариантную часть записи?  
**Размер памяти, который выделяется под вариантную часть представляет из
себя максимальный размер одной из объединенных структур. Например, у
меня в union находятся две структуры, одна из которых больше другой на
256 Байт (Память, выделенная на поле street). Поэтому при выделение
памяти для массива структур размера N будет выделено N \* (размер
большей структуры)

**2.Что будет, если в вариантную часть ввести данные, не соответствующие
описанным?  
**Программа выдаст Undefined behavior. Результат системы будет трудно
предсказуем, возможно произойдет приведение типов. Поэтому необходимо
делать верификацию каждого введенного параметра, как это я выполнил в
работе, чтобы программа работала корректно.

**3.Кто должен следить за правильностью выполнения операций с вариантной
частью записи?**  
За правильностью выполнения операций с вариантной частью записи должны
следить флаг и функции верификации ввода и обработки.

**4.Что представляет собой таблица ключей, зачем она нужна?  
**Таблица ключей представляет из себя таблицу с номерами записи в
исходном массиве и ключа, по которому происходит сортировка. Такое
решение ускоряет время работы программы, когда структура большая из-за
того, что не происходит постоянной операции перезаписи и сама структура
весит значительно меньше, потому что содержит только два поля.

**5.В каких случаях эффективнее обрабатывать данные в самой таблице, а
когда – использовать таблицу ключей?**  
Данные эффективнее обрабатывать в таблице, когда размер и память,
выделяемая на структуру мала, либо же количество сортируемых записей
невелико. Сортировку с таблицей ключей, как мы выяснили в лабораторной,
необходимо в тот момент, когда структура большая и невыгодно работать с
ее “тяжелыми” полями - это значительно усложняет работу и ее время.

**6.Какие способы сортировки предпочтительнее для обработки таблиц и
почему?  
**Конечно, если мы имеет структуру, состоящую из двух элементов, то
бесспортно создавать таблицу ключей не имеет смысла. Но если в рабочей
структуре 5 и более полей, то таблица ключей позволит ускорить работу
программу и облегчить написание кода с той точки зрения, что не нужно
производить процессе переприсваивания всех полей структуры, после каждой
удачной операции сравнения элементов.
